<!doctype html>
<html lang="es-MX">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Marshanta</title>
    <link rel="manifest" href="/manifest.webmanifest" />
    <meta name="theme-color" content="#0ea5e9" />
    <link
      rel="stylesheet"
      href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
      integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY="
      crossorigin=""
    />
    <style>
      :root { --bg:#0b1220; --card:#0f172a; --fg:#e2e8f0; --muted:#93c5fd; }
      * { box-sizing: border-box; }
      body { margin:0; font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto; background: var(--bg); color: var(--fg); }
      header { padding: 16px 20px; background: #0ea5e9; color:#081018; font-weight: 700; display:flex; align-items:center; justify-content:space-between; gap:12px; }
      .badge { display:inline-block; padding:4px 8px; border-radius:999px; font-size:12px; font-weight:700; background:#081018; color:#0ea5e9; border:1px solid #0284c7; }
      .status { margin-left:8px; }
      .status-Submitted { background:#0b1220; color:#93c5fd; border-color:#334155; }
      .status-Accepted { background:#0b1220; color:#a3e635; border-color:#3f6212; }
      .status-Preparing { background:#0b1220; color:#f59e0b; border-color:#92400e; }
      .status-ReadyForPickup { background:#0b1220; color:#f472b6; border-color:#831843; }
      .pay-Unpaid, .pay-Failed { background:#0b1220; color:#f87171; border-color:#7f1d1d; }
      .pay-Paid, .pay-Succeeded { background:#0b1220; color:#34d399; border-color:#065f46; }
      main { max-width: 800px; margin: 24px auto; padding: 0 16px; }
      .card { background: rgba(15,23,42,0.75); backdrop-filter: blur(10px); border: 1px solid rgba(148,163,184,0.08); border-radius: 16px; padding: 16px; margin-bottom: 16px; box-shadow: 0 10px 30px rgba(0,0,0,0.35); }
      button { background:#0ea5e9; color:#081018; border:0; padding:10px 14px; border-radius:10px; font-weight:600; cursor:pointer; }
      input { padding:10px; border-radius:10px; border:1px solid #334155; background:#0b1220; color:var(--fg); }
      .row { display:flex; gap:8px; flex-wrap:wrap; }
      .muted { color: var(--muted); font-size: 12px; }
      .chat { min-height: 140px; }
      .log { font-family: ui-monospace, SFMono-Regular, Menlo, monospace; font-size: 12px; white-space: pre-wrap; }
      #map { width: 100%; height: 260px; border-radius: 12px; overflow: hidden; border: 1px solid #1f2937; }
      /* Auth Modal */
      .auth-overlay { position: fixed; inset: 0; background: radial-gradient(1200px 600px at 20% 10%, rgba(14,165,233,0.25), transparent 60%), radial-gradient(1200px 600px at 80% 90%, rgba(34,197,94,0.25), transparent 60%), linear-gradient(180deg, rgba(2,6,23,0.9), rgba(2,6,23,0.95)); display: none; align-items: center; justify-content: center; backdrop-filter: blur(6px); z-index: 1000; }
      .auth-card { width: 92%; max-width: 480px; background: rgba(15,23,42,0.9); border: 1px solid #1f2937; border-radius: 16px; padding: 20px; box-shadow: 0 20px 60px rgba(0,0,0,0.45); }
      .tabs { display: flex; gap: 8px; margin-bottom: 12px; }
      .tab { flex: 1; text-align: center; padding: 10px; border-radius: 10px; background: #0b1220; color: var(--fg); border:1px solid #1f2937; cursor: pointer; }
      .tab.active { background:#0ea5e9; color:#081018; border-color:#0284c7; font-weight: 700; }
      .role-chips { display:flex; gap:8px; flex-wrap:wrap; margin-top:8px; }
      .chip { padding:6px 10px; border-radius:999px; border:1px solid #334155; background:#0b1220; color:var(--fg); cursor:pointer; font-size:12px; }
      .chip.selected { background:#0ea5e9; color:#081018; border-color:#0284c7; font-weight:700; }
      .auth-actions { display:flex; gap:8px; margin-top:12px; }
      .auth-close { position:absolute; top:16px; right:16px; background:transparent; color:#e2e8f0; border:1px solid #334155; }
      /* Marketing */
      .hero { position: relative; overflow: hidden; border-radius: 20px; padding: 24px; background: linear-gradient(135deg, rgba(14,165,233,0.28), rgba(34,197,94,0.22)); border:1px solid rgba(148,163,184,0.1); box-shadow: 0 20px 60px rgba(0,0,0,0.45); backdrop-filter: blur(12px); }
      .hero h2 { margin: 0 0 8px 0; }
      .hero p { margin: 0 0 12px 0; color: var(--muted); }
      .grid { display:grid; grid-template-columns: repeat(auto-fit, minmax(160px, 1fr)); gap: 12px; }
      .feature { background: rgba(2,6,23,0.6); backdrop-filter: blur(8px); border:1px solid rgba(148,163,184,0.08); border-radius:14px; padding:12px; box-shadow: 0 6px 20px rgba(0,0,0,0.3); }
      .gallery { display:grid; grid-template-columns: repeat(auto-fit, minmax(160px, 1fr)); gap: 8px; }
      .gallery img { width: 100%; height: 120px; object-fit: cover; border-radius: 14px; border:1px solid rgba(148,163,184,0.08); box-shadow: 0 8px 24px rgba(0,0,0,0.35); transition: transform .3s ease, box-shadow .3s ease; }
      .gallery img:hover { transform: translateY(-2px) scale(1.01); box-shadow: 0 12px 32px rgba(0,0,0,0.45); }
      /* How it works modal */
      .how-overlay { position: fixed; inset: 0; background: rgba(2,6,23,0.55); backdrop-filter: blur(8px); display: none; align-items: center; justify-content: center; z-index: 1001; }
      .how-card { width: 92%; max-width: 560px; background: rgba(15,23,42,0.86); border: 1px solid rgba(148,163,184,0.1); border-radius: 18px; padding: 20px; box-shadow: 0 20px 60px rgba(0,0,0,0.45); }
      .steps { display:grid; gap:10px; }
      /* Reveal animations */
      [data-reveal] { opacity: 0; transform: translateY(14px); transition: opacity .6s ease, transform .6s ease; }
      [data-reveal].in { opacity: 1; transform: translateY(0); }
    </style>
  </head>
  <body>
    <!-- How it works Modal -->
    <div id="howOverlay" class="how-overlay" aria-hidden="true">
      <div class="how-card">
        <h3>¿Cómo funciona?</h3>
        <div class="steps">
          <div class="feature"><strong>1. Explora restaurantes</strong><p class="muted">Descubre tus lugares favoritos cerca de ti.</p></div>
          <div class="feature"><strong>2. Arma tu pedido</strong><p class="muted">Agrega platillos al carrito y revisa el total.</p></div>
          <div class="feature"><strong>3. Paga seguro</strong><p class="muted">Finaliza con un checkout rápido y transparente.</p></div>
          <div class="feature"><strong>4. Rastrea en vivo</strong><p class="muted">Sigue a tu repartidor y recibe tu pedido a tiempo.</p></div>
        </div>
        <div class="row" style="margin-top:12px">
          <button id="howCloseBtn" style="background:#0b1220; color:var(--fg); border:1px solid #334155">Cerrar</button>
          <button id="howSignupBtn">Crear cuenta</button>
        </div>
      </div>
    </div>
    <!-- Auth Modal -->
    <div id="authOverlay" class="auth-overlay" aria-hidden="true">
      <button id="authClose" class="auth-close">✕</button>
      <div class="auth-card">
        <div class="tabs">
          <button id="tabLogin" class="tab active">Iniciar sesión</button>
          <button id="tabSignup" class="tab">Crear cuenta</button>
        </div>
        <div class="row">
          <input id="authEmail" type="email" placeholder="correo electrónico" style="flex:1; min-width:240px" />
          <input id="authPassword" type="password" placeholder="contraseña" style="flex:1; min-width:160px" />
        </div>
        <div id="authRoleRow" class="role-chips" style="display:none">
          <span class="muted">Soy:</span>
          <button class="chip" data-role="client">Cliente</button>
          <button class="chip" data-role="staff">Personal</button>
          <button class="chip" data-role="delivery">Repartidor</button>
          <button class="chip" data-role="admin">Admin</button>
        </div>
        <div class="auth-actions">
          <button id="authLoginBtn" style="flex:1">Entrar</button>
          <button id="authSignupBtn" style="flex:1">Crear cuenta</button>
        </div>
        <p class="muted" style="margin-top:8px">Tip: Elige tu rol al registrarte. En dispositivos, configura primero el API Base con la IP de tu computadora.</p>
      </div>
    </div>
    <header>
      <div>Marshanta — Tu comida favorita, a tu puerta</div>
      <div class="badge" id="roleBadge">rol: invitado</div>
    </header>
    <main>
      <!-- Marketing (Cliente) -->
      <section class="card" id="marketingSection" style="display:none">
        <div class="hero">
          <h2>Pide comida a tu manera</h2>
          <p>Explora menús, ordena en segundos y rastrea a tu repartidor en tiempo real.</p>
          <div class="row">
            <button id="mkStartOrderBtn">Empieza tu pedido</button>
            <button id="mkHowItWorksBtn" style="background:#0b1220; color:var(--fg); border:1px solid #334155">¿Cómo funciona?</button>
          </div>
        </div>
        <div style="height:12px"></div>
        <div class="gallery">
          <img alt="Tacos" src="https://images.unsplash.com/photo-1601924582971-b0c5be3a5c9a?q=80&w=800&auto=format&fit=crop" />
          <img alt="Hamburguesa" src="https://images.unsplash.com/photo-1550547660-d9450f859349?q=80&w=800&auto=format&fit=crop" />
          <img alt="Pizza" src="https://images.unsplash.com/photo-1542831371-29b0f74f9713?q=80&w=800&auto=format&fit=crop" />
          <img alt="Sushi" src="https://images.unsplash.com/photo-1544025162-d76694265947?q=80&w=800&auto=format&fit=crop" />
          <img alt="Ensalada" src="https://images.unsplash.com/photo-1555939594-58d7cb561ad1?q=80&w=800&auto=format&fit=crop" />
          <img alt="Postre" src="https://images.unsplash.com/photo-1551024709-8f23befc6cf7?q=80&w=800&auto=format&fit=crop" />
        </div>
        <div style="height:12px"></div>
        <div class="grid">
          <div class="feature"><strong>Checkout rápido</strong><p class="muted">Repite tus favoritos en un toque.</p></div>
          <div class="feature"><strong>Rastreo en vivo</strong><p class="muted">Conoce el ETA y la ruta del repartidor.</p></div>
          <div class="feature"><strong>Precio claro</strong><p class="muted">Transparencia del carrito a tu puerta.</p></div>
          <div class="feature"><strong>Negocios locales</strong><p class="muted">Apoya a tu comunidad.</p></div>
        </div>
      </section>
      <section class="card" data-reveal>
        <h3>Instalar</h3>
        <p class="muted">Agrega a la pantalla de inicio para una mejor experiencia.</p>
        <button id="installBtn" hidden>Instalar app</button>
      </section>

      <section class="card" id="deliverySection" style="display:none" data-reveal>
        <h3>Reparto</h3>
        <p class="muted">Esta sección es visible solo cuando inicias sesión como <code>repartidor</code>.</p>
        <div class="row" style="align-items:center;gap:8px">
          <button id="delRefreshBtn" title="Actualizar mis asignaciones">Actualizar</button>
          <label style="display:flex;align-items:center;gap:6px">
            <input type="checkbox" id="delShareLocation" />
            <span class="muted">Compartir ubicación en vivo</span>
          </label>
          <span class="badge" id="delBell" title="Notificaciones no leídas">0</span>
        </div>
        <div style="margin-top:12px">
          <h4>Mis asignaciones</h4>
          <ul id="delAssignments"></ul>
        </div>
        <div style="margin-top:12px">
          <h4>Notificaciones</h4>
          <ul id="delNotifications"></ul>
        </div>
        <p class="muted">Acciones: Acepta una asignación, luego marca Recogido y Entregado. Activa compartir ubicación para enviar tu posición durante el servicio.</p>
      </section>

      <section class="card">
        <h3>Bienvenido</h3>
        <div id="chat" class="chat"></div>
        <div class="row">
          <input id="chatInput" type="text" placeholder="Escribe un comando (p. ej., 'ver restaurantes', 'menú tacos', 'agregar 2 tacos')" style="flex:1; min-width:240px" />
          <button id="chatSendBtn">Enviar</button>
        </div>
        <div class="row">
          <input id="email" type="email" placeholder="correo electrónico" />
          <input id="password" type="password" placeholder="contraseña" />
          <select id="role">
            <option value="client" selected>cliente</option>
            <option value="staff">personal</option>
            <option value="admin">admin</option>
            <option value="delivery">repartidor</option>
          </select>
          <button id="registerBtn">Registrar</button>
          <button id="loginBtn">Entrar</button>
          <button id="logoutBtn">Salir</button>
        </div>
        <p class="muted">API Base: <code id="apiBase"></code></p>
        <div class="row">
          <input id="apiBaseInput" type="text" placeholder="http://192.168.1.70:4000" style="flex:1; min-width:240px" />
          <button id="setApiBaseBtn" title="Guardar API Base y recargar">Guardar API Base</button>
          <button id="clearApiBaseBtn" title="Borrar API Base guardado y recargar">Borrar</button>
        </div>
      </section>

      <section class="card" data-reveal>
        <h3>Restaurantes</h3>
        <div class="row">
          <button id="loadRestaurantsBtn">Ver restaurantes</button>
        </div>
        <ul id="restaurantsList"></ul>
      </section>

      <section class="card" data-reveal>
        <h3>Menú</h3>
        <p class="muted" id="menuHeader">Ningún restaurante seleccionado.</p>
        <ul id="menuList"></ul>
      </section>

      <section class="card" data-reveal>
        <h3>Carrito</h3>
        <ul id="cartList"></ul>
        <p><strong>Total:</strong> <span id="cartTotal">$0.00</span></p>
        <div class="row">
          <button id="clearCartBtn">Vaciar carrito</button>
          <button id="reviewOrderBtn">Revisar pedido</button>
          <button id="placeOrderBtn">Realizar pedido</button>
          <button id="refreshOrdersBtn">Actualizar pedidos</button>
        </div>
      </section>

      <section class="card" data-reveal>
        <h3>Pedidos</h3>
        <ul id="ordersList"></ul>
      </section>

      <section class="card" id="rcSection" data-reveal>
        <h3>Consola del restaurante</h3>
        <div class="row">
          <select id="rcRestaurant"></select>
          <button id="rcLoadOrdersBtn">Cargar pedidos</button>
        </div>
        <div class="row">
          <label>
            <span class="muted">Estatus:</span>
            <select id="rcStatusFilter">
              <option value="all" selected>todas</option>
              <option value="Submitted">Enviada</option>
              <option value="Accepted">Aceptada</option>
              <option value="Preparing">Preparando</option>
              <option value="ReadyForPickup">Lista para recoger</option>
            </select>
          </label>
          <label style="display:flex;align-items:center;gap:6px">
            <input type="checkbox" id="rcAutoRefresh" />
            <span class="muted">Autoactualizar</span>
          </label>
        </div>
        <p id="rcHint" class="muted" style="display:none">La Consola del restaurante está disponible solo para personal o administrador.</p>
        <ul id="rcOrdersList"></ul>
      </section>

      <section class="card" data-reveal>
        <h3>Rastreo</h3>
        <p class="muted">Pedido activo: <span id="trackingOrder">—</span></p>
        <div id="trackingStatus">Sin rastreo.</div>
        <div id="trackingCoords" class="muted"></div>
        <div id="map"></div>
        <div class="row">
          <button id="stopTrackingBtn">Detener rastreo</button>
        </div>
      </section>

      <section class="card" id="adminSection" style="display:none" data-reveal>
        <h3>Panel de administración</h3>
        <p class="muted">Vista de administrador enfocada en escritorio. Visible solo para usuarios con rol <code>admin</code>.</p>
        <div class="row" style="gap:12px; align-items:center">
          <div class="badge" title="Usuarios totales"><span id="admUsers">0</span> usuarios</div>
          <div class="badge" title="Restaurantes totales"><span id="admRestaurants">0</span> restaurantes</div>
          <div class="badge" title="Pedidos totales"><span id="admOrders">0</span> pedidos</div>
          <div class="badge" title="Ingresos"><span id="admRevenue">$0.00</span> ingresos</div>
          <div style="margin-left:auto; display:flex; align-items:center; gap:8px">
            <span class="badge" id="admBell" title="Notificaciones no leídas">0</span>
            <button id="admRefreshBtn" title="Actualizar datos de admin">Actualizar</button>
          </div>
        </div>
        <div class="row" style="margin-top:12px">
          <div style="flex:1; min-width:280px">
            <h4>Usuarios</h4>
            <ul id="admUsersList"></ul>
          </div>
          <div style="flex:1; min-width:280px">
            <h4>Restaurantes</h4>
            <ul id="admRestaurantsList"></ul>
          </div>
        </div>
        <div style="margin-top:12px">
          <h4>Pedidos</h4>
          <ul id="admOrdersList"></ul>
        </div>
        <div style="margin-top:12px">
          <h4>Notificaciones</h4>
          <ul id="admNotifications"></ul>
        </div>
      </section>

      <section class="card">
        <h3>Debug</h3>
        <div id="log" class="log"></div>
      </section>
    </main>
    <script
      src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
      integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo="
      crossorigin=""
    ></script>
    <script type="module" src="/main.js"></script>
  </body>
</html>
