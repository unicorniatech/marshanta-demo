# Story 3.2: Delivery Partner Order Assignment

## Status

Draft

## Story

**As a** delivery partner,
**I want** to be notified of new delivery requests and accept an assignment,
**so that** I can begin my delivery route promptly.

## Acceptance Criteria

1. Delivery partners receive a real-time assignment notification with pickup and drop-off details.
2. Delivery partners can accept or decline the assignment.
3. On acceptance, the delivery partner status changes to "On the Way to Restaurant" and is visible to operations and client.
4. Declined or timed-out assignments are re-queued per routing policy.
5. Assignment timeout duration is configurable and surfaced in the prompt/UI.

## Tasks / Subtasks

- [ ] Assignment notification (AC: 1)
  - [ ] Subscribe partner app to assignment events (push/WS)
  - [ ] Display pickup, drop-off, restaurant contact, and order code
- [ ] Accept/decline flow (AC: 2)
  - [ ] Timed prompt with clear CTA buttons
  - [ ] Handle timeouts and auto-decline
  - [ ] Surface remaining time and honor configurable timeout (AC: 5)
- [ ] Status transition + propagation (AC: 3)
  - [ ] Update partner status to On the Way to Restaurant
  - [ ] Propagate to client chat and restaurant dashboard
- [ ] Re-queue policy (AC: 4)
  - [ ] On decline/timeout, trigger re-dispatch per policy (stub policy here)

## Dev Notes

- Source reference: `docs/architecture/high-level-architecture.md` (events/queues, status model)
- Keep UI minimal; focus on reliable event handling and clear accept/decline logic.
- Define `DispatchService` and `DeliveryPartnerService` interfaces.

### Testing

- Simulate assignment event; test accept, decline, timeout.
- Verify status propagation to client and restaurant.
- Timeout tests: different configured durations correctly applied and enforced.

## Change Log

| Date | Version | Description | Author |
| :--- | :------ | :---------- | :----- |
| 2025-08-15 | 1.0 | Initial draft of Story 3.2 | PO |

## Dev Agent Record

### Agent Model Used



### Debug Log References



### Completion Notes List

