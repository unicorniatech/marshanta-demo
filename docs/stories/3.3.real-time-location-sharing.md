# Story 3.3: Real-time Location Sharing

## Status

Draft

## Story

**As a** delivery partner,
**I want** my location to be shared with the platform in real-time during active deliveries,
**so that** clients can track their order on a live map.

## Acceptance Criteria

1. The delivery partner app securely publishes GPS location updates while an order is active.
2. The platform ingests and processes locations in near real-time.
3. The client PWA map (from Story 2.3) displays current courier position and updates smoothly.
4. Location updates stop and session is cleaned up when the order is completed.

## Tasks / Subtasks

- [ ] Partner app location stream (AC: 1)
  - [ ] Permission checks and opt-in UX
  - [ ] Publish throttled updates (e.g., every 3â€“5s; adaptive)
- [ ] Ingestion & distribution (AC: 2)
  - [ ] Receive updates via API/WS; validate and normalize payload
  - [ ] Push to interested subscribers (client map, ops dashboard)
- [ ] Client display integration (AC: 3)
  - [ ] Subscribe PWA map view to delivery stream for active order
  - [ ] Smooth marker interpolation; handle jitter
- [ ] Lifecycle management (AC: 4)
  - [ ] Stop stream on Delivered/Cancelled; cleanup subscriptions

## Dev Notes

- Source reference: `docs/architecture/high-level-architecture.md` (real-time channels, websocket/stream infra)
- Privacy & security: only share during active delivery; never persist raw path beyond needed retention.
- Define `LocationStreamAdapter` to abstract transport.

### Testing

- Simulate GPS updates; verify ingestion and client map updates.
- Edge cases: permission denied, background app suspend, network loss.

## Change Log

| Date | Version | Description | Author |
| :--- | :------ | :---------- | :----- |
| 2025-08-15 | 1.0 | Initial draft of Story 3.3 | PO |

## Dev Agent Record

### Agent Model Used



### Debug Log References



### Completion Notes List

